{template 'common/header'}
<title>活动</title>
<style type="text/css">
    body {margin:0px; background:#EEEEEE; font-family:'微软雅黑'; -moz-appearance:none;}
    a {text-decoration:none;}
    .team_top {height:44px; width:100%;  background:#f8f8f8;  border-bottom:1px solid #e3e3e3;}
    .team_top .title {height:44px; width:auto;margin-left:10px; float:left; font-size:16px; line-height:44px; color:#666;}

    .team_list_head {height:20px; width:94%; background:#fff; padding:10px 3%;border-bottom:1px solid #eaeaea;}
    .team_list_head .time {height:20px; width:40%; float:left;  font-size:14px; color:#666; line-height:20px; text-align:left;}
    .team_list_head .amount {height:20px; width:20%; float:left;  font-size:14px; color:#666; line-height:20px; text-align:left;}
    .team_list_head .desc {height:20px; float:right; text-align:right; font-size:14px; color:#666; line-height:20px;  color:#999;}


    .team_list {height:280px; width:94%; background:#fff; padding:10px 3%;}
    .team_list .img {height:40px; width:16%; float:left; text-align:left;}

    team_list .time {
        height: 30px;
        width: 40%;
        float: left;
        font-size: 12px;
        color: #666;
        text-align: left;
        line-height: 30px;
    }
    .team_list .amount {height:30px; width:20%; float:left;  font-size:12px; color:#666; line-height:30px; text-align:left;}
    .team_list .desc {height:30px; float:right; text-align:right; font-size:12px;line-height:30px;color:#999;}

    .team_list .title {height:40px; width:100%; float:left; font-size:20px; color:#666; line-height:40px; text-align:left;}
    .team_list .amount {height:40px; width:20%; float:left;  font-size:14px; color:#666; line-height:40px; text-align:left;}
    .team_list .stime {height:40px; float:left; text-align:right; font-size:14px; color:#666; line-height:40px;  color:#999;width: 56%;overflow: hidden}

    .team_tab {height:30px; margin:5px; border:1px solid #ff6801; border-radius:5px; overflow:hidden;font-size:13px;background:#fff;padding-right: -2px;}
    .team_nav {height:30px;  background:#fff; color:#666; text-align:center; line-height:30px; float:left;}
    .team_navon {color:#fff; background:#ff6801;}
    .team_no {height:100px; width:100%; margin:50px 0px 60px; color:#ccc; font-size:12px; text-align:center;}
    #team_loading { padding:10px;color:#666;text-align: center;}

    .info_main .line .inner { margin-left:80px; }
    .line .inner input {height:40px; width:100%;display:block; padding:0px; margin:0px; border:0px; float:left; font-size:16px;}

    #search{
        float: left;
        width: 10%;
        text-align: center;
        color: #545454;
    }
    .time-set-box{
        width: 100%;
        overflow: hidden;
        padding: 18px 0;
        background: #E2E2E2;
    }
    #search i{}
    .start-time{
        width: 45%;
        float: left;
    }
    .end-time{
        width: 45%;
        float: left;
    }
    .end-time input{
        width: 53%;
        float: left;
        padding: 0;
        margin: 0;
        border: 1px solid #B3B3B3;
        background: #fff;
        height:20px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .start-time input{
        width: 53%;
        float: left;
        padding: 0;
        margin: 0;
        border: 1px solid #B3B3B3;
        background: #fff;
        height:20px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .tit-box{
        height: 40px;
        line-height: 40px;
        text-align: center;
        background: #cf4336;
    }
    .tit-box p{
        margin: 0;
        font-size: 18px;
        color: #fff;
    }
    .back-btn{
        position: absolute;
        left: 10px;
        top: 12px;
        color: #fff;
    }
    .time-set-box .txt{
        width: 35%;
        font-size: 14px;
        margin: 0 5%;
        float: left;
        display: block;
        height: 22px;
        line-height: 22px;
        text-align: right;
    }
    .headimg {
        text-align: center;
    }

</style>

<div class="tit-box">
    <i class='fa fa-chevron-left back-btn'onclick='window.history.back()'></i>
</div>



<div id='container'></div>

<script id='tpl_list' type='text/html'>

    <%each list as activity%>
    <div class="team_list">
        <div class="headimg" onclick="location='{php echo $this->createMobileUrl('enroll/detail')}'">
            <img src="<%activity.headimg%>">
        </div>
        <div class="bottom">
            <p><div class="title"><%activity.title%></div></p>
            <div class="stime">活动时间:<%activity.activity_stime%></div>
        </div>
    </div>
    <%/each%>
</script>
<script id='tpl_empty' type='text/html'>
    <div class="team_no"><br><span style="line-height:18px; font-size:16px;">还没有相关活动信息~</span></div>
</script>

<script language="javascript">
    var page = 1;
    var current_level = 1;
    require(['tpl', 'core'], function (tpl, core) {

        function bindScroller(){

            //加载更多
            var loaded = false;
            var stop = true;
            var starttime = $('#starttime').val();
            var endtime = $('#endtime').val();
            $(window).scroll(function () {
                if (loaded) {
                    return;
                }
                $('#team_loading').remove();
                totalheight = parseFloat($(window).height()) + parseFloat($(window).scrollTop());
                if ($(document).height() <= totalheight) {

                    if (stop == true) {
                        stop = false;
                        $('#container').append('<div id="team_loading"><i class="fa fa-spinner fa-spin"></i> 正在加载...</div>');
                        page++;
                        core.json('enroll/list', {page: page, starttime: starttime, endtime: endtime}, function (morejson) {
                            stop = true;
                            $('#team_loading').remove();
                            $("#container").append(tpl('tpl_list', morejson.result));
                            if (morejson.result.list.length < morejson.result.pagesize) {
                                $("#container").append('<div id="team_loading">已经加载完全部数据</div>');
                                loaded = true;
                                $(window).scroll = null;
                                return;
                            }
                        }, true);
                    }
                }
            });
        }
        function getActivities() {
            var starttime = $('#starttime').val();
            var endtime = $('#endtime').val();
            core.json('enroll/list', {page: page, starttime: starttime, endtime: endtime}, function (json) {
                if (json.result.list.length <= 0) {
                    $('#container').html(tpl('tpl_empty'));
                    return;
                }
                $('#container').html(tpl('tpl_list', json.result));
                bindScroller();
            }, true);
        }
        $('#search').click(function () {
            getActivities();
        });

        getActivities();

    })
</script>
